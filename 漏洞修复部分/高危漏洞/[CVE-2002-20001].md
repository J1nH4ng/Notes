# [CVE-2002-20001]

## 基本信息

- 漏洞详情查看：[CVE-2002-20001 漏洞报告](https://www.tenable.com/cve/CVE-2002-20001)
- 影响的版本：$\text{OpenSSH} < \text{4.1p1}$、$\text{8.5p1} < \text{OpenSSH} \leq \text{9.8p1}$

## 修复办法

### 确认客户端支持的`kexalgorithms`

使用如下命令查看支持的`kexalgorithms`

```bash
ssh -Q kex
```

结果如下：

```bash
diffie-hellman-group1-sha1
diffie-hellman-group14-sha1
diffie-hellman-group14-sha256
diffie-hellman-group16-sha512
diffie-hellman-group18-sha512
diffie-hellman-group-exchange-sha1
diffie-hellman-group-exchange-sha256
ecdh-sha2-nistp256
ecdh-sha2-nistp384
ecdh-sha2-nistp521
curve25519-sha256
curve25519-sha256@libssh.org
sntrup761x25519-sha512@openssh.com
```

### 查看当前客户端使用的`kexalgorithms`

使用如下命令查看当前使用客户端使用的`kexalgorithms`

```bash
sshd -T | grep -w kexalgorithms
```

结果如下：

```bash
kexalgorithms sntrup761x25519-sha512@openssh.com,curve25519-sha256,curve25519-sha256@libssh.org,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521,diffie-hellman-group-exchange-sha256,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,diffie-hellman-group14-sha256
```

可以查看到有`diffie-hellman`系列的加密算法在使用中。

测试使用`diffie-hellman`算法连接

```bash
ssh -v -oKexAlgorithms=diffie-hellman-group-exchange-sha256 root@<target-ip>
```

可以观察到可以成功连接，我们需要禁用`diffie-hellman`算法的使用


### 禁用`diffie-hellman`算法

指定具体使用的算法，并写入进 SSH 的配置文件中：

```bash
echo "KexAlgorithms sntrup761x25519-sha512@openssh.com,curve25519-sha256,curve25519-sha256@libssh.org,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521" >> /etc/ssh/sshd_config
```

写入后，重启 SSH 服务：

```bash
systemctl restart sshd
```

## 修复测试

测试使用`diffie-hellman`算法连接：

```bash
ssh -v -oKexAlgorithms=diffie-hellman-group-exchange-sha256 root@<target-ip>
```

可以查看到无法连接，接着测试不指定算法连接：

```bash
ssh root@<target-ip>
```

可以查看到可以正常连接。